<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hemibrain olfactory projection neurons • neuprintr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="hemibrain olfactory projection neurons">
<meta property="og:description" content="neuprintr">
<meta property="og:image" content="https://natverse.org/neuprintr/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">neuprintr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/customquery.html">Writing query functions in neuprintr</a>
    </li>
    <li>
      <a href="../articles/hemibrain_opns.html">hemibrain olfactory projection neurons</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/natverse/neuprintr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>hemibrain olfactory projection neurons</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/natverse/neuprintr/blob/HEAD/vignettes/hemibrain_opns.Rmd" class="external-link"><code>vignettes/hemibrain_opns.Rmd</code></a></small>
      <div class="hidden name"><code>hemibrain_opns.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>“FROM many directions, workers are tunnelling hopefully into the
mountain, some with steam shovels and others with dental drills. Some
travel blindly in a circle and come out close to their point of
entrance; some connect, usually in a mismatched fashion, with the
burrows of others. Some have chosen to disregard the random activities
of their fellows and have worked out in a small region an elegant system
of tunnels of their own. Both the attraction and confusion of this
multitudinous excavation lie in the fact that none of these workers
knows precisely what they are looking for, or what they will find.” (<a href="https://www.springer.com/gp/book/9783642692734" class="external-link">Kenneth
Roeder</a>)</p>
</blockquote>
<div class="section level2">
<h2 id="inspecting-the-hemibrain">Inspecting the hemibrain<a class="anchor" aria-label="anchor" href="#inspecting-the-hemibrain"></a>
</h2>
<p>The largest draft connectome to date was released on the 22nd of
January, 2020. The <a href="https://www.janelia.org/project-team/flyem/hemibrain" class="external-link">FlyEM
Janelia HemiBrain project</a> has released 21,662 neurons, many more
fragments, and almost 10 million synapses. About 35% of its
automatically predicted synapses have been matched up to a
semi-automatically traced ‘body’ deemed large enough to constitute an
identifiable neuron. This data can be accessed using our R package <a href="https://github.com/natverse/neuprintr/" class="external-link">neuprintr</a> to query a
publically accessible <a href="https://neuprint.janelia.org/" class="external-link">neuPrint
explorer instance</a>.</p>
<div class="section level3">
<h3 id="lock-and-load">Lock and load<a class="anchor" aria-label="anchor" href="#lock-and-load"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">'devtools'</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">'natverse'</span><span class="op">)</span><span class="op">)</span> <span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"natverse/natverse"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">'ComplexHeatmap'</span><span class="op">)</span><span class="op">)</span> <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"ComplexHeatmap"</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/briatte/ggnetwork" class="external-link">'ggnetwork'</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggnetwork"</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://statnet.org/" class="external-link">'network'</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"network"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">natverse</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://natverse.org/neuprintr">neuprintr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dendroextras</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ComplexHeatmap</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/briatte/ggnetwork" class="external-link">ggnetwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://statnet.org/" class="external-link">network</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Colours</span></span>
<span><span class="co">## some nice colors!! Inspired by LaCroixColoR</span></span>
<span><span class="va">lacroix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#C70E7B"</span>, <span class="st">"#FC6882"</span>, <span class="st">"#007BC3"</span>, <span class="st">"#54BCD1"</span>, <span class="st">"#EF7C12"</span>, <span class="st">"#F4B95A"</span>, </span>
<span>            <span class="st">"#009F3F"</span>, <span class="st">"#8FDA04"</span>, <span class="st">"#AF6125"</span>, <span class="st">"#F4E3C7"</span>, <span class="st">"#B25D91"</span>, <span class="st">"#EFC7E6"</span>, </span>
<span>            <span class="st">"#EF7C12"</span>, <span class="st">"#F4B95A"</span>, <span class="st">"#C23A4B"</span>, <span class="st">"#FBBB48"</span>, <span class="st">"#EFEF46"</span>, <span class="st">"#31D64D"</span>, </span>
<span>            <span class="st">"#132157"</span>,<span class="st">"#EE4244"</span>, <span class="st">"#D72000"</span>, <span class="st">"#1BB6AF"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lacroix</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"pink"</span>,</span>
<span>                   <span class="st">"blue"</span>, <span class="st">"cyan"</span>,</span>
<span>                   <span class="st">"darkorange"</span>, <span class="st">"paleorange"</span>,</span>
<span>                   <span class="st">"darkgreen"</span>, <span class="st">"green"</span>,</span>
<span>                   <span class="st">"brown"</span>, <span class="st">"palebrown"</span>,</span>
<span>                   <span class="st">"mauve"</span>, <span class="st">"lightpink"</span>,</span>
<span>                   <span class="st">"orange"</span>, <span class="st">"midorange"</span>,</span>
<span>                   <span class="st">"darkred"</span>, <span class="st">"darkyellow"</span>,</span>
<span>                   <span class="st">"yellow"</span>, <span class="st">"palegreen"</span>, </span>
<span>                   <span class="st">"navy"</span>,<span class="st">"cerise"</span>,</span>
<span>                   <span class="st">"red"</span>, <span class="st">"marine"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Then see if a simple function works for you:</span></span>
<span><span class="va">available.datasets</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_info.html">neuprint_datasets</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">available.datasets</span></span></code></pre></div>
<p>If you need help/have not before logged into neuPrint via R, please
see the package README or see <code><a href="../reference/neuprint_login.html">?neuprint_login</a></code>.</p>
<p>The main point is that you can then edit your R.environ file to
contain information about the neuPrint server you want to speak with,
your token and the dataset hosted by that server, that you want to read.
You can use the package <code>usethis</code> to easily edit your R
environ file. You will need to add these lines to your R environ to
specify the hemibrain dataset:</p>
<p><code>neuprint_token="YOUR_TOKEN_HERE"</code>
<code>neuprint_server='https://neuprint.janelia.org/'</code>
<code>neuprint_dataset='hemibrain:v1.0'</code></p>
<p>Leave a blank line at the end of the file.</p>
<p>Then restart your R session.</p>
</div>
<div class="section level3">
<h3 id="find-neurons">Find neurons<a class="anchor" aria-label="anchor" href="#find-neurons"></a>
</h3>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_an_opn.png" alt=""><p class="caption">hemibrain_an_opn</p>
</div>
<p>First, we need to find neurons to read from neuPrint. We can do this
easily in two ways - we can search by name, and we can search by brain
region.</p>
<p>So what do we want to look at? Some of the best studied neurons in
the brain are the olfactory projections neurons (OPNs) <a href="https://www.ncbi.nlm.nih.gov/pubmed/27653699" class="external-link">Grabe et
al. 2016</a>. These are second-order olfactory neurons that project from
the fly’s equivalent of the olfactory bulb, i.e. the antennal lobe, to
higher order brain regions that generate innate behaviours (the lateral
horn, LH) <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6550879" class="external-link">(Frechter.
209,</a> <a href="https://www.ncbi.nlm.nih.gov/pubmed/31112130" class="external-link">Dolan et
al. 2019)</a> and learning &amp; memory (the mushroom body) <a href="https://www.ncbi.nlm.nih.gov/pubmed/25535793" class="external-link">(Aso et
al. 2014a,</a> <a href="https://www.ncbi.nlm.nih.gov/pubmed/25535794" class="external-link">Aso et
al. 2014b)</a>. We know a fair bit about them, compared with most
neurons in the fly brain. For example, a bit of their odour response
profiles <a href="https://www.ncbi.nlm.nih.gov/pubmed/27321924" class="external-link">Badel et
al., 2016</a>.</p>
<p>Perhaps we could look at some popular OPN types and see if they
connect to each other? How do we get this information?</p>
<p>Let’s find some in our HemiBrain data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Let's find some in our HemiBrain data:</span></span>
<span><span class="va">opn.info</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_search.html">neuprint_search</a></span><span class="op">(</span><span class="st">".*mPN1.*"</span><span class="op">)</span></span>
<span><span class="va">opn.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">opn.info</span><span class="op">$</span><span class="va">type</span><span class="op">)</span>,<span class="st">"type"</span><span class="op">]</span> <span class="op">=</span> <span class="va">opn.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">opn.info</span><span class="op">$</span><span class="va">type</span><span class="op">)</span>,<span class="st">"name"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">opn.info</span><span class="op">)</span> <span class="op">=</span> <span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span></span>
<span><span class="co">#### Add AL glomerulus information from the name</span></span>
<span><span class="va">name.split</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">opn.info</span><span class="op">$</span><span class="va">name</span>,split<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"\\(|\\_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gloms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">name.split</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gloms</span><span class="op">)</span> <span class="op">=</span> <span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span></span>
<span><span class="va">opn.info</span><span class="op">$</span><span class="va">glomerulus</span> <span class="op">=</span> <span class="va">gloms</span></span>
<span><span class="va">opn.info</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">opn.info</span>, <span class="va">glomerulus</span><span class="op">!=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#### so there seem to be</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">gloms</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#### OPNs and</span></span>
<span><span class="co">#### And</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">gloms</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#### OPNs with unique glomerulus innervations</span></span>
<span></span>
<span><span class="co">## Let's see what meta-info we get, along with stuff with 'mPN1' in the name.</span></span>
<span><span class="co">## This is a reference to the OPN naming scheme by Tanaka et al. (2012)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">opn.info</span><span class="op">)</span></span>
<span><span class="co">### Looks like we get their unique ID numbers (bodyIds), cell names,</span></span>
<span><span class="co">### types, their size (voxels) and synapse numbers (pre=output, post=input).</span></span>
<span></span>
<span><span class="co">## Let's quickly read one neuron, and have a look at it!</span></span>
<span><span class="va">opn</span> <span class="op">=</span> <span class="fu">neuprint_read_neuron</span><span class="op">(</span><span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">### visualise:</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nopen3d.html" class="external-link">nopen3d</a></span><span class="op">(</span>userMatrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.985064148902893</span>, <span class="fl">0.164582148194313</span>, </span>
<span><span class="fl">0.05061025172472</span>, <span class="fl">0</span>, <span class="fl">0.00997132062911987</span>, <span class="op">-</span><span class="fl">0.347956597805023</span>, </span>
<span><span class="fl">0.93745756149292</span>, <span class="fl">0</span>, <span class="fl">0.171898916363716</span>, <span class="op">-</span><span class="fl">0.922951519489288</span>, <span class="op">-</span><span class="fl">0.344400823116302</span>, </span>
<span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, .Dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4L</span>, <span class="fl">4L</span><span class="op">)</span><span class="op">)</span>, zoom <span class="op">=</span> <span class="fl">0.746215641498566</span>, </span>
<span>    windowRect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20L</span>, <span class="fl">65L</span>, <span class="fl">1191L</span>, <span class="fl">843L</span><span class="op">)</span><span class="op">)</span> <span class="co"># set view</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">opn</span>, WithConnectors <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="va">lacroix</span><span class="op">[[</span><span class="st">"brown"</span><span class="op">]</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"images"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/snapshot.html" class="external-link">rgl.snapshot</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"images/hemibrain_an_opn.png"</span>, fmt <span class="op">=</span><span class="st">"png"</span><span class="op">)</span></span>
<span><span class="co">### output synapses in red, input ones in blue</span></span>
<span><span class="co">### You can see the auto-segmentation goes a bit crazy where the soma is</span></span>
<span></span>
<span><span class="co">## Now that we have all of the bodyIds, we can read these neurons from neuPrint:</span></span>
<span><span class="va">opns</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_read_neurons.html">neuprint_read_skeletons</a></span><span class="op">(</span><span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nopen3d.html" class="external-link">nopen3d</a></span><span class="op">(</span>userMatrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.98370349407196</span>, <span class="op">-</span><span class="fl">0.104569993913174</span>, </span>
<span>                                 <span class="op">-</span><span class="fl">0.146263062953949</span>, <span class="fl">0</span>, <span class="fl">0.147007316350937</span>, <span class="op">-</span><span class="fl">0.000597098842263222</span>, </span>
<span>                                 <span class="fl">0.989135324954987</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.103521309792995</span>, <span class="op">-</span><span class="fl">0.994517505168915</span>, </span>
<span>                                 <span class="fl">0.0147849693894386</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, .Dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4L</span>, <span class="fl">4L</span><span class="op">)</span><span class="op">)</span>, zoom <span class="op">=</span> <span class="fl">0.644609212875366</span>, </span>
<span>        windowRect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20L</span>, <span class="fl">65L</span>, <span class="fl">1191L</span>, <span class="fl">843L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">opns</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">lacroix</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">opns</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/snapshot.html" class="external-link">rgl.snapshot</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"images/hemibrain_opns.png"</span>, fmt <span class="op">=</span><span class="st">"png"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The simple version of read neurons just reads the skeleton for a neuron</span></span>
<span><span class="co">### We might also want our neuron objects to contain meta data and synapse information</span></span>
<span><span class="co">### We have an all-in-one function to do this. Here we go!</span></span>
<span><span class="va">opns</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_read_neurons.html">neuprint_read_skeletons</a></span><span class="op">(</span><span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##But why is this function so slow?</span></span>
<span><span class="co">### Because it fetches fragmented neuron skeletons assigned to the same neuron</span></span>
<span><span class="co">### Stitched them into one neuron (healing), grabs all the neuron's synapses</span></span>
<span><span class="co">### and tries to work out where the soma is. If you want to move faster</span></span>
<span><span class="co">### You can grab bits separately and quickly:</span></span>
<span><span class="op">?</span><span class="va">neuprint_read_skeletons</span></span>
<span><span class="op">?</span><span class="va">neuprint_get_synapses</span></span>
<span><span class="op">?</span><span class="va">neuprint_assign_connectors</span></span>
<span><span class="op">?</span><span class="va">neuprint_locate_soma</span></span>
<span><span class="op">?</span><span class="va">neuprint_get_neuron_names</span></span>
<span><span class="op">?</span><span class="va">neuprint_get_meta</span></span>
<span></span>
<span><span class="co">## Do we have to know what's in the name to find interesting neurons? No!</span></span>
<span><span class="co">### We can also read neurons from a region of interest (ROI) of the brain.</span></span>
<span><span class="co">### The regions of interest available are:</span></span>
<span><span class="va">rois</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="../reference/neuprint_ROIs.html">neuprint_ROIs</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rois</span></span>
<span></span>
<span><span class="co">## We don't we try fetching all of the neurons in a glomerulus of the mushroom body input zone, the calyx?</span></span>
<span><span class="va">ca.info</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_find_neurons.html">neuprint_find_neurons</a></span><span class="op">(</span></span>
<span>  input_ROIs <span class="op">=</span> <span class="st">"CA(R)"</span>,</span>
<span>  output_ROIs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  all_segments <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># if true, fragments smaller than 'neurons' are returned as well</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## So how many neurons is that?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ca.info</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## A lot! But what about that pesky load of Kenyon cells</span></span>
<span><span class="co">### The most populous neurons in the brain</span></span>
<span><span class="va">ca.info</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ca.info</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">bodyname</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">neuronStatus</span> <span class="op">==</span> <span class="st">"Traced"</span><span class="op">)</span></span>
<span><span class="va">ca.info</span> <span class="op">=</span> <span class="va">ca.info</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"KC"</span>,<span class="va">ca.info</span><span class="op">$</span><span class="va">bodyname</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">## So how many neurons is that?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ca.info</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Getting all that data took a while, so let's save it for later</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">opns</span>,file <span class="op">=</span> <span class="st">"hemibrain_opns.rda"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_opns.png" alt=""><p class="caption">hemibrain_opns</p>
</div>
</div>
<div class="section level3">
<h3 id="get-neuropil-volumes">Get neuropil volumes<a class="anchor" aria-label="anchor" href="#get-neuropil-volumes"></a>
</h3>
<p>So it is nice that we now have some neurons. But it would be good to
see them with their neuropil context.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_olfactory_neuropils.png" alt=""><p class="caption">hemibrain_olfactory_neuropils</p>
</div>
<p>Let’s fetch some volume data to plot:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Let's get some neuropil volume data from neuPrint!</span></span>
<span><span class="co">### Specifically, in the last R file we chose to look at OPNs</span></span>
<span><span class="co">### So let's fetch their meshes for the antennal lobe!</span></span>
<span><span class="co">### First, we gotta see what is available:</span></span>
<span><span class="va">rois</span></span>
<span></span>
<span><span class="co"># Read in the AL mesh!</span></span>
<span><span class="va">al.mesh</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span><span class="op">(</span>roi <span class="op">=</span> <span class="st">"AL(R)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nopen3d.html" class="external-link">nopen3d</a></span><span class="op">(</span>userMatrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.947127282619476</span>, <span class="fl">0.222770735621452</span>, </span>
<span>                                 <span class="op">-</span><span class="fl">0.230919197201729</span>, <span class="fl">0</span>, <span class="fl">0.247805655002594</span>, <span class="op">-</span><span class="fl">0.0506941750645638</span>, </span>
<span>                                 <span class="fl">0.967482566833496</span>, <span class="fl">0</span>, <span class="fl">0.203820571303368</span>, <span class="op">-</span><span class="fl">0.973551869392395</span>, </span>
<span>                                 <span class="op">-</span><span class="fl">0.103217624127865</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, .Dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4L</span>, <span class="fl">4L</span><span class="op">)</span><span class="op">)</span>, zoom <span class="op">=</span> <span class="fl">0.58467960357666</span>, </span>
<span>        windowRect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1460L</span>, <span class="fl">65L</span>, <span class="fl">2877L</span>, <span class="fl">996L</span><span class="op">)</span><span class="op">)</span> <span class="co"># set view</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">al.mesh</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="va">lacroix</span><span class="op">[[</span><span class="st">"orange"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># And  get the other main olfactory neuropils</span></span>
<span><span class="va">ca.mesh</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span><span class="op">(</span>roi <span class="op">=</span> <span class="st">"CA(R)"</span><span class="op">)</span></span>
<span><span class="va">lh.mesh</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span><span class="op">(</span>roi <span class="op">=</span> <span class="st">"LH(R)"</span><span class="op">)</span></span>
<span><span class="va">malt.mesh</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span><span class="op">(</span>roi <span class="op">=</span> <span class="st">"mALT(R)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">ca.mesh</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, col <span class="op">=</span> <span class="va">lacroix</span><span class="op">[[</span><span class="st">"pink"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">lh.mesh</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, col <span class="op">=</span> <span class="va">lacroix</span><span class="op">[[</span><span class="st">"green"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">malt.mesh</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.9</span>, col <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/snapshot.html" class="external-link">rgl.snapshot</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"images/hemibrain_olfactory_neuropils.png"</span>, fmt <span class="op">=</span><span class="st">"png"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Maybe get the whole hemibrai mesh?</span></span>
<span><span class="co">## hemibrain = neuprint_ROI_mesh(roi = "hemibrain")</span></span>
<span></span>
<span><span class="co"># And with some neurons!</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nopen3d.html" class="external-link">nopen3d</a></span><span class="op">(</span>userMatrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.98370349407196</span>, <span class="op">-</span><span class="fl">0.104569993913174</span>, </span>
<span>                                 <span class="op">-</span><span class="fl">0.146263062953949</span>, <span class="fl">0</span>, <span class="fl">0.147007316350937</span>, <span class="op">-</span><span class="fl">0.000597098842263222</span>, </span>
<span>                                 <span class="fl">0.989135324954987</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.103521309792995</span>, <span class="op">-</span><span class="fl">0.994517505168915</span>, </span>
<span>                                 <span class="fl">0.0147849693894386</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, .Dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4L</span>, <span class="fl">4L</span><span class="op">)</span><span class="op">)</span>, zoom <span class="op">=</span> <span class="fl">0.644609212875366</span>, </span>
<span>        windowRect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20L</span>, <span class="fl">65L</span>, <span class="fl">1191L</span>, <span class="fl">843L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">al.mesh</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">ca.mesh</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">lh.mesh</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">opns</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">lacroix</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">opns</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/snapshot.html" class="external-link">rgl.snapshot</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"images/hemibrain_opns_neuropils.png"</span>, fmt <span class="op">=</span><span class="st">"png"</span><span class="op">)</span></span></code></pre></div>
<p>Here is what the neurons look like with these brain meshes:</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_opns_neuropils.png" alt=""><p class="caption">hemibrain_opns_neuropils</p>
</div>
</div>
<div class="section level3">
<h3 id="get-connectivity">Get connectivity<a class="anchor" aria-label="anchor" href="#get-connectivity"></a>
</h3>
<p>And now the really exciting bit! How do these neurons connect to each
other?</p>
<p>First we will look at connectivity between OPN types.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_uPN_connections.png" alt=""><p class="caption">hemibrain_uPN_connections</p>
</div>
<p>Then we will follow up on their connectivity with other neurons in
the brain. We will focus on the uniglomerular projection neuron (uPN)
from the apple cider vinegar detecting glomerulus, DM1. It is already
known that it is a hub for connectivity in the lateral horn, impinging
on the axons of other food-odour related projection neurons <a href="https://www.biorxiv.org/content/10.1101/2020.01.19.911453v1" class="external-link">(Bates
and Schlegel et al., 2020)</a>. We’ll see in the code below, that we can
find that this PNs’ (orange) strongest downstream targets include these
neurons in the lateral horn (the part of the brain that generates
‘innate’ behaviours):</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_DM1_strong_LH_targets.png" alt=""><p class="caption">hemibrain_DM1_strong_LH_targets</p>
</div>
<p>And that other uPNs can influence them both directly and via
interstitial neurons:</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_uPN_inputs_to_select_LHNs.png" alt=""><p class="caption">hemibrain_uPN_inputs_to_select_LHNs</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## We are looking at connectivity between OPNs.</span></span>
<span><span class="co">### We can get an adjaceny matrix between all of these OPNs</span></span>
<span><span class="va">opn.adj</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_get_adjacency_matrix.html">neuprint_get_adjacency_matrix</a></span><span class="op">(</span>bodyids <span class="op">=</span> <span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">opn.adj</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">opn.adj</span><span class="op">)</span> <span class="op">=</span> <span class="va">opn.info</span><span class="op">$</span><span class="va">type</span></span>
<span></span>
<span><span class="co">## Let's visualise this connectivity</span></span>
<span><span class="va">my_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lacroix</span><span class="op">[[</span><span class="st">"cyan"</span><span class="op">]</span><span class="op">]</span>,<span class="va">lacroix</span><span class="op">[[</span><span class="st">"yellow"</span><span class="op">]</span><span class="op">]</span>, <span class="va">lacroix</span><span class="op">[[</span><span class="st">"orange"</span><span class="op">]</span><span class="op">]</span>, <span class="va">lacroix</span><span class="op">[[</span><span class="st">"cerise"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">(</span>n<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"images/OPN_interconnectivity.pdf"</span>, height <span class="op">=</span> <span class="fl">10</span>, width <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu">Heatmap</span><span class="op">(</span><span class="va">opn.adj</span>,</span>
<span>        col <span class="op">=</span> <span class="va">my_palette</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## It is hard to parse this information mentally</span></span>
<span><span class="co">### What if we just see what the glomerulus to glomerulus connectivity is?</span></span>
<span><span class="va">opn.adj.comp</span> <span class="op">=</span> <span class="va">opn.adj</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">opn.adj.comp</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">opn.adj.comp</span><span class="op">)</span> <span class="op">=</span> <span class="va">opn.info</span><span class="op">$</span><span class="va">glomerulus</span></span>
<span><span class="va">opn.adj.comp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">opn.adj.comp</span><span class="op">)</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">opn.adj.comp</span><span class="op">)</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">opn.adj.comp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">opn.adj.comp</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">opn.adj.comp</span><span class="op">)</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"images/OPN_glomerulus_interconnectivity.pdf"</span>, height <span class="op">=</span> <span class="fl">10</span>, width <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu">Heatmap</span><span class="op">(</span><span class="va">opn.adj.comp</span>,</span>
<span>        col <span class="op">=</span> <span class="va">my_palette</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## What about OPN connectivity to neurons not in this set of OPNs?</span></span>
<span><span class="co">### First, is there a common partner to all OPNs?</span></span>
<span><span class="va">common</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_common_connectivity.html">neuprint_common_connectivity</a></span><span class="op">(</span><span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span>, prepost <span class="op">=</span> <span class="st">"PRE"</span><span class="op">)</span> <span class="co"># could use 'post' for downstream</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">common</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">### What about the food hub PNs?</span></span>
<span><span class="co">### The glomerulus DM1 is interesting, because it is involved in an axo-axonic</span></span>
<span><span class="co">### 'food odour' related community in the lateral horn (Bates &amp; Schlegel et al. 2020)</span></span>
<span><span class="va">DM1.opn.info</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">opn.info</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"DM1|DM3|DM4|VM3|VA4"</span>,<span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DM1.common</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_common_connectivity.html">neuprint_common_connectivity</a></span><span class="op">(</span><span class="va">DM1.opn.info</span><span class="op">$</span><span class="va">bodyid</span>, prepost <span class="op">=</span> <span class="st">"PRE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">DM1.common</span><span class="op">)</span> </span>
<span><span class="va">DM1.common.meta</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_get_meta.html">neuprint_get_meta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">DM1.common</span><span class="op">)</span><span class="op">)</span> <span class="co"># what are they?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">DM1.common.meta</span><span class="op">)</span> <span class="co"># Huhh, local neurons, the APL and some LH stuff</span></span>
<span></span>
<span><span class="co">## Another interesting question we can ask is whether PNs get axonic inouts in the calyx</span></span>
<span><span class="co">### from Kenyon cells (KCs). In their other axon collateral in the LH it has already been shown</span></span>
<span><span class="co">### That they get innervation from local neurons.</span></span>
<span><span class="va">kc.info</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_search.html">neuprint_search</a></span><span class="op">(</span><span class="st">"KC.*"</span><span class="op">)</span></span>
<span><span class="va">opn.conn</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_connection_table.html">neuprint_connection_table</a></span><span class="op">(</span>bodyids <span class="op">=</span> <span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span>, prepost <span class="op">=</span> <span class="st">"PRE"</span><span class="op">)</span></span>
<span><span class="va">opn.conn</span> <span class="op">=</span> <span class="va">opn.conn</span><span class="op">[</span><span class="va">opn.conn</span><span class="op">$</span><span class="va">partner</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">kc.info</span><span class="op">$</span><span class="va">bodyid</span>,<span class="op">]</span></span>
<span><span class="va">opn.conn</span><span class="op">$</span><span class="va">glom</span> <span class="op">=</span> <span class="va">gloms</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">opn.conn</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">glom.conn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="va">opn.conn</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>glom <span class="op">=</span> <span class="va">opn.conn</span><span class="op">$</span><span class="va">glom</span>,</span>
<span>                           prepost <span class="op">=</span> <span class="va">opn.conn</span><span class="op">$</span><span class="va">prepost</span><span class="op">)</span>,</span>
<span>                      <span class="va">sum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">opn.conn</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span> <span class="co"># Most barely connect</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">opn.conn</span><span class="op">$</span><span class="va">weight</span>, breaks <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">glom.conn</span><span class="op">$</span><span class="va">weight</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">glom.conn</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="co"># However if you add up by uPN cell type, the numbers can look high</span></span>
<span></span>
<span><span class="co">## We can also get all of the neurons in the database that connect to the</span></span>
<span><span class="co">### query neurons, either upstream or downstream of them</span></span>
<span><span class="va">DM1.opn.connected</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_connection_table.html">neuprint_connection_table</a></span><span class="op">(</span><span class="va">DM1.opn.info</span><span class="op">$</span><span class="va">bodyid</span>, prepost <span class="op">=</span> <span class="st">"POST"</span><span class="op">)</span></span>
<span><span class="co">### In which brain region are these partners?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">DM1.opn.connected</span><span class="op">$</span><span class="va">roi</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Important note!!</span></span>
<span><span class="co">### The results from neuprint_connection_table can list the same bodyid-partner pairing</span></span>
<span><span class="co">### multiple times if by.roi = TRUE. This is because there is a separate entry for each of FlyEM's designated</span></span>
<span><span class="co">### regions of interest (ROIs), and because a super-level ROI can include multiple smaller ROIs. </span></span>
<span></span>
<span><span class="co">## Let's have a look at what the strongest downstream partners look like</span></span>
<span><span class="va">DM1.opn.connected.strong</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">DM1.opn.connected</span>,<span class="va">weight</span><span class="op">&gt;</span><span class="fl">100</span>, prepost <span class="op">=</span> <span class="st">"POST"</span><span class="op">)</span></span>
<span><span class="va">DM1.targets</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_read_neurons.html">neuprint_read_neurons</a></span><span class="op">(</span><span class="va">DM1.opn.connected.strong</span><span class="op">$</span><span class="va">partner</span><span class="op">)</span></span>
<span><span class="va">DM1.targets</span> <span class="op">=</span> <span class="fu">unspike</span><span class="op">(</span><span class="va">DM1.targets</span>, threshold<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nopen3d.html" class="external-link">nopen3d</a></span><span class="op">(</span>userMatrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.964227318763733</span>, <span class="op">-</span><span class="fl">0.0444099828600883</span>, </span>
<span><span class="op">-</span><span class="fl">0.261329621076584</span>, <span class="fl">0</span>, <span class="fl">0.249727189540863</span>, <span class="op">-</span><span class="fl">0.178416073322296</span>, </span>
<span><span class="fl">0.951737523078918</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.088891975581646</span>, <span class="op">-</span><span class="fl">0.982952415943146</span>, </span>
<span><span class="op">-</span><span class="fl">0.160943150520325</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, .Dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4L</span>, <span class="fl">4L</span><span class="op">)</span><span class="op">)</span>, zoom <span class="op">=</span> <span class="fl">0.783526360988617</span>, </span>
<span>    windowRect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6L</span>, <span class="fl">71L</span>, <span class="fl">1434L</span>, <span class="fl">927L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">DM1.targets</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">lacroix</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DM1.targets</span><span class="op">)</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/snapshot.html" class="external-link">rgl.snapshot</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"images/hemibrain_DM1_strong_downstream_partners.png"</span>, fmt <span class="op">=</span><span class="st">"png"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">DM1.targets</span><span class="op">[</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## So there are three lateral horn neuron targets of the axon there</span></span>
<span><span class="co">### c("359214479", "359891881", "511616870"), found using nat::find.neuron</span></span>
<span><span class="co">### Let's move forward with those</span></span>
<span><span class="va">lhns</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"359214479"</span>, <span class="st">"359891881"</span>, <span class="st">"511616870"</span><span class="op">)</span></span>
<span><span class="va">lhn.cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lacroix</span><span class="op">[[</span><span class="st">"marine"</span><span class="op">]</span><span class="op">]</span>,<span class="va">lacroix</span><span class="op">[[</span><span class="st">"blue"</span><span class="op">]</span><span class="op">]</span>,<span class="va">lacroix</span><span class="op">[[</span><span class="st">"green"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lhn.cols</span><span class="op">)</span> <span class="op">=</span> <span class="va">DM1.targets</span><span class="op">[</span><span class="va">lhns</span>,<span class="st">"type"</span><span class="op">]</span></span>
<span><span class="va">lh.targets</span> <span class="op">=</span> <span class="va">DM1.targets</span><span class="op">[</span><span class="va">lhns</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/scene.html" class="external-link">clear3d</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">lh.targets</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lacroix</span><span class="op">[[</span><span class="st">"marine"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                    <span class="va">lacroix</span><span class="op">[[</span><span class="st">"blue"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                    <span class="va">lacroix</span><span class="op">[[</span><span class="st">"green"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">opns</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"DM1"</span>,<span class="va">name</span><span class="op">)</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="va">lacroix</span><span class="op">[[</span><span class="st">"orange"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/snapshot.html" class="external-link">rgl.snapshot</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"images/hemibrain_DM1_strong_LH_targets.png"</span>, fmt <span class="op">=</span><span class="st">"png"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Can other OPNs influence these strong partners?</span></span>
<span><span class="co">### Which other OPNs impinge on it?</span></span>
<span><span class="co">### Via whatever path?</span></span>
<span><span class="va">shortest.paths</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">lhn</span> <span class="kw">in</span> <span class="va">lhns</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span><span class="op">{</span> <span class="co"># PN -&gt; LHN</span></span>
<span>    <span class="va">sp</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_get_shortest_paths.html">neuprint_get_shortest_paths</a></span><span class="op">(</span>body_pre <span class="op">=</span> <span class="va">b</span>, body_post <span class="op">=</span> <span class="va">lhn</span>, weightT <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="va">dupe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">sp</span><span class="op">$</span><span class="va">to</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sp</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">sp</span><span class="op">$</span><span class="va">to</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">shortest</span> <span class="op">=</span> <span class="va">sp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">dupe</span>,<span class="op">]</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">5</span> <span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">shortest</span><span class="op">$</span><span class="va">order.to</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></span>
<span>      <span class="va">shortest</span><span class="op">$</span><span class="va">order.from</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></span>
<span>      <span class="va">shortest</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"order.from"</span><span class="op">]</span> <span class="op">=</span> <span class="va">opn.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span>,<span class="st">"glomerulus"</span><span class="op">]</span></span>
<span>      <span class="va">shortest</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span>,<span class="st">"order.to"</span><span class="op">]</span> <span class="op">=</span> <span class="va">DM1.targets</span><span class="op">[</span><span class="va">lhn</span>,<span class="st">"type"</span><span class="op">]</span></span>
<span>      <span class="va">shortest.paths</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">shortest.paths</span>, <span class="va">shortest</span><span class="op">)</span> </span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">opn.info</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span><span class="op">{</span> <span class="co"># LHN -&gt; PN</span></span>
<span>    <span class="va">sp</span> <span class="op">=</span> <span class="fu"><a href="../reference/neuprint_get_shortest_paths.html">neuprint_get_shortest_paths</a></span><span class="op">(</span>body_post <span class="op">=</span> <span class="va">b</span>, body_pre <span class="op">=</span> <span class="va">lhn</span>, weightT <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="va">dupe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">sp</span><span class="op">$</span><span class="va">to</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sp</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">sp</span><span class="op">$</span><span class="va">to</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">shortest</span> <span class="op">=</span> <span class="va">sp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">dupe</span>,<span class="op">]</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">shortest</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"order.from"</span><span class="op">]</span> <span class="op">=</span> <span class="va">opn.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span>,<span class="st">"glomerulus"</span><span class="op">]</span></span>
<span>      <span class="va">shortest</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shortest</span><span class="op">)</span>,<span class="st">"order.to"</span><span class="op">]</span> <span class="op">=</span> <span class="va">DM1.targets</span><span class="op">[</span><span class="va">lhn</span>,<span class="st">"type"</span><span class="op">]</span></span>
<span>      <span class="va">shortest.paths</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">shortest.paths</span>, <span class="va">shortest</span><span class="op">)</span> </span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Make network</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">paths</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="va">shortest.paths</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>order.from <span class="op">=</span> <span class="va">shortest.paths</span><span class="op">$</span><span class="va">order.from</span>,</span>
<span>                                                             order.to <span class="op">=</span> <span class="va">shortest.paths</span><span class="op">$</span><span class="va">order.to</span><span class="op">)</span>,</span>
<span>                           <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu">network</span><span class="op">(</span><span class="va">paths</span>,</span>
<span>            matrix.type <span class="op">=</span> <span class="st">"edgelist"</span>,</span>
<span>            ignore.eval <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            layout <span class="op">=</span> <span class="st">"fruchtermanreingold"</span>,</span>
<span>            names.eval <span class="op">=</span> <span class="st">"weight"</span>,</span>
<span>            directed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu">ggnetwork</span><span class="op">(</span><span class="va">n</span>, cell.jitter <span class="op">=</span> <span class="fl">0.75</span>, arrow.gap <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set colours</span></span>
<span><span class="va">orders</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">order.to</span>,<span class="va">paths</span><span class="op">$</span><span class="va">order.from</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">order.cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"grey30"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">orders</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">order.cols</span><span class="op">)</span> <span class="op">=</span> <span class="va">orders</span></span>
<span><span class="va">gloms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">opn.info</span><span class="op">$</span><span class="va">glomerulus</span><span class="op">)</span></span>
<span><span class="va">opn.cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">lacroix</span><span class="op">[[</span><span class="st">"orange"</span><span class="op">]</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">gloms</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">opn.cols</span><span class="op">)</span> <span class="op">=</span> <span class="va">gloms</span></span>
<span><span class="va">opn.cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">opn.cols</span>,<span class="va">lhn.cols</span>,<span class="va">order.cols</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">order.cols</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lhn.cols</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">opn.cols</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"images/DM1_OPN_input_graph.pdf"</span>, height <span class="op">=</span> <span class="fl">5</span>, width <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">n</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_edges</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">vertex.names</span><span class="op">)</span>,</span>
<span>             curvature <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>             arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">6</span>, <span class="st">"pt"</span><span class="op">)</span>, </span>
<span>                           type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_nodes</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">vertex.names</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_edgetext</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">weight</span>, color <span class="op">=</span> <span class="va">vertex.names</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_nodelabel_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">vertex.names</span>, label <span class="op">=</span> <span class="va">vertex.names</span><span class="op">)</span>,</span>
<span>                       fontface <span class="op">=</span> <span class="st">"bold"</span>, box.padding <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">opn.cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">opn.cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_blank</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span>, shape <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">FALSE</span>, size <span class="op">=</span> <span class="cn">FALSE</span>, linetype <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="article">Article<a class="anchor" aria-label="anchor" href="#article"></a>
</h3>
<p><strong>A Connectome of the Adult Drosophila Central
Brain</strong></p>
<p>Shan Xu, C; Januszewski, Michal; Lu, Zhiyuan; Takemura, Shin-Ya;
Hayworth, Kenneth; Huang, Gary; Shinomiya, Kazunori; Maitin-Shepard,
Jeremy; Ackerman, David; Berg, Stuart; Blakely, Tim; Bogovic, John;
Clements, Jody; Dolafi, Tom; Hubbard, Philip; Kainmueller, Dagmar; Katz,
William; Kawase, Takashi; Khairy, Khaled; Leavitt, Laramie; Li, Peter H;
Lindsey, Larry; Neubarth, Nicole; Olbris, Donald J; Otsuna, Hideo;
Troutman, Eric T; Umayam, Lowell; Zhao, Ting; Ito, Masayoshi; Goldammer,
Jens; Wolff, Tanya; Svirskas, Robert; Schlegel, Philipp; Neace, Erika R;
Knecht, Christopher J; Alvarado, Chelsea X; Bailey, Dennis; Ballinger,
Samantha; Borycz, Jolanta A; Canino, Brandon; Cheatham, Natasha; Cook,
Michael; Dreyer, Marisa; Duclos, Octave; Eubanks, Bryon; Fairbanks,
Kelli; Finley, Samantha; Forknall, Nora; Francis, Audrey; Hopkins, Gary
Patrick; Joyce, Emily M; Kim, Sungjin; Kirk, Nicole A; Kovalyak, Julie;
Lauchie, Shirley A; Lohff, Alanna; Maldonado, Charli; Manley, Emily A;
McLin, Sari; Mooney, Caroline; Ndama, Miatta; Ogundeyi, Omotara; Okeoma,
Nneoma; Ordish, Christopher; Padilla, Nicholas; Patrick, Christopher;
Paterson, Tyler; Phillips, Elliott E; Phillips, Emily M; Rampally, Neha;
Ribeiro, Caitlin; Robertson, Madelaine K; Rymer, Jon Thomson; Ryan, Sean
M; Sammons, Megan; Scott, Anne K; Scott, Ashley L; Shinomiya, Aya;
Smith, Claire; Smith, Kelsey; Smith, Natalie L; Sobeski, Margaret A;
Suleiman, Alia; Swift, Jackie; Takemura, Satoko; Talebi, Iris;
Tarnogorska, Dorota; Tenshaw, Emily; Tokhi, Temour; Walsh, John J; Yang,
Tansy; Horne, Jane Anne; Li, Feng; Parekh, Ruchi; Rivlin, Patricia K;
Jayaraman, Vivek; Ito, Kei; Saalfeld, Stephan; George, Reed;
Meinertzhagen, Ian; Rubin, Gerald M; Hess, Harald F; Scheffer, Louis K;
Jain, Viren; Plaza, Stephen M</p>
<p>bioRxiv, Jan 21, 2020 <a href="https://www.biorxiv.org/content/10.1101/2020.01.21.911859v1" class="external-link">10.1101/2020.01.21.911859</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Bates, Gregory Jefferis, Romain Franconville.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
